"use strict";(self.webpackChunk=self.webpackChunk||[]).push([[544],{95502:function(e,t,r){var n=r(36552),i=(r(93236),r(62086));t.Z=function(e){var t=e.modalVisible,r=e.onCancel;return(0,i.jsx)(n.Z,{destroyOnClose:!0,title:"新建",width:"80vw",open:t,onCancel:function(){return r()},footer:null,children:e.children})}},9793:function(e,t,r){r.r(t),r.d(t,{default:function(){return q}});var n=r(48305),i=r.n(n),o=r(74585),a=r(25637),s=r(98451),u=r(38968),l=r(93631),c=r(65193),d=r(51077),p=r(26068),f=r.n(p),x=r(90228),g=r.n(x),m=r(87999),y=r.n(m),b=r(95502),v=r(61201),h=r(62834),w=r(62086),j=function(e){var t,r=e.type,n=void 0===r?"add":r,s=e.id,u=e.visible,c=e.onCancel,d=(0,a.yR)((function(){return o.f.tagType.orderBy("sort").toArray()}),[],[]),p=(0,a.yR)((function(){return o.f.tag.orderBy("sort").toArray()}),[],[]),x=(0,l.Z)(!1),m=i()(x,2),j=m[0],k=m[1].set,Z=(0,a.yR)((function(){return"update"===n&&s?o.f.tag.get(s):void 0}),[s,n],void 0),C=(0,a.yR)((function(){return o.f.tag.orderBy("sort").last().then((function(e){return(null==e?void 0:e.sort)||0}))}),[],0),T=[{title:"名称",dataIndex:"name",formItemProps:{initialValue:(null==Z?void 0:Z.name)||"",validateFirst:!0,rules:[{required:!0},{validator:(t=y()(g()().mark((function e(t,r){return g()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if("update"===n||null==p||!p.some((function(e){return e.name===r}))){e.next=2;break}return e.abrupt("return",Promise.reject(new Error("标签名称不能重复")));case 2:return e.abrupt("return",Promise.resolve());case 3:case"end":return e.stop()}}),e)}))),function(e,r){return t.apply(this,arguments)})}]}},{title:"类型",dataIndex:"type",valueType:"select",valueEnum:function(){return d.reduce((function(e,t){return e.set(t.id,{text:t.name}),e}),new Map)},formItemProps:{initialValue:null==Z?void 0:Z.type}},{title:"排序",dataIndex:"sort",valueType:"digit",formItemProps:{initialValue:(null==Z?void 0:Z.sort)||C+1,rules:[{required:!0}]},fieldProps:{precision:0,max:C+1,min:0,className:"w-full"}}];return u&&"update"===n&&!s?(h.ZP.open({type:"error",content:"缺少id，无法更新"}),(0,w.jsx)(w.Fragment,{})):(0,w.jsx)(b.Z,{modalVisible:u,onCancel:c,children:(0,w.jsx)(v.Z,{loading:j,onSubmit:function(){var e=y()(g()().mark((function e(t){return g()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return k(!0),console.log("add new tag",t),e.next=4,o.f.tag.put(f()(f()({},t),{},{sort:t.sort||1,id:s})).then((function(){c()})).catch((function(e){console.log(e),h.ZP.open({type:"error",content:"名称重复了"})}));case 4:k(!1);case 5:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),rowKey:"id",type:"form",columns:T})})},k=function(e){var t,r=e.type,n=void 0===r?"add":r,s=e.id,u=e.visible,c=e.onCancel,d=h.ZP.useMessage(),p=i()(d,1)[0],x=(0,a.yR)((function(){return o.f.tagType.orderBy("sort").toArray()}),[],[]),m=(0,l.Z)(!1),j=i()(m,2),k=j[0],Z=j[1].set,C=(0,a.yR)((function(){return"update"===n&&s?o.f.tagType.get(s):void 0}),[s,n],void 0),T=(0,a.yR)((function(){return o.f.tagType.orderBy("sort").last().then((function(e){return(null==e?void 0:e.sort)||0}))}),[],0),P=[{title:"名称",dataIndex:"name",formItemProps:{initialValue:(null==C?void 0:C.name)||"",validateFirst:!0,rules:[{required:!0},{validator:(t=y()(g()().mark((function e(t,r){return g()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if("update"===n||null==x||!x.some((function(e){return e.name===r}))){e.next=2;break}return e.abrupt("return",Promise.reject(new Error("标签分类名称不能重复")));case 2:return e.abrupt("return",Promise.resolve());case 3:case"end":return e.stop()}}),e)}))),function(e,r){return t.apply(this,arguments)})}]}},{title:"排序",dataIndex:"sort",valueType:"digit",formItemProps:{initialValue:(null==C?void 0:C.sort)||T+1,rules:[{required:!0}]},fieldProps:{precision:0,max:T+1,min:1,className:"w-full"}}];return"update"!==n||s?(0,w.jsx)(b.Z,{modalVisible:u,onCancel:c,children:(0,w.jsx)(v.Z,{loading:k,onSubmit:function(){var e=y()(g()().mark((function e(t){return g()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return Z(!0),console.log("add new tagType",t),e.next=4,o.f.tagType.put(f()(f()({},t),{},{sort:t.sort||1,id:s})).then((function(){c()})).catch((function(e){console.log(e),p.open({type:"error",content:"名称重复了"})}));case 4:Z(!1);case 5:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),rowKey:"id",type:"form",columns:P})}):(p.open({type:"error",content:"缺少id，无法更新"}),(0,w.jsx)(w.Fragment,{}))},Z=r(67825),C=r.n(Z),T=r(39300),P=r(81183),I=r(82937),R=r(2769),B=r(36552),F=r(93236),V=["tag"],N={cursor:"move",transition:"unset"},A=function(e){var t=e.tag,r=C()(e,V),n=(0,R.nB)({id:t.id}),i=n.listeners,o=n.transform,a=n.transition,s=n.isDragging,l=n.setNodeRef,c=o?f()(f()({},N),{},{transform:"translate3d(".concat(o.x,"px, ").concat(o.y,"px, 0)"),transition:s?"unset":a}):N;return(0,w.jsx)("div",{style:c,ref:l,children:(0,w.jsx)(u.Z,f()(f()(f()({hoverable:!0,bordered:!0},r),i),{},{children:t.name}))})},D=["text-red-600 border-red-200 bg-red-50","text-orange-600 border-orange-200 bg-orange-50","text-amber-600 border-amber-200 bg-amber-50","text-yellow-600 border-yellow-200 bg-yellow-50","text-lime-600 border-lime-200 bg-lime-50","text-green-600 border-green-200 bg-green-50","text-emerald-600 border-emerald-200 bg-emerald-50","text-teal-600 border-teal-200 bg-teal-50","text-cyan-600 border-cyan-200 bg-cyan-50","text-sky-600 border-sky-200 bg-sky-50","text-blue-600 border-blue-200 bg-blue-50","text-indigo-600 border-indigo-200 bg-indigo-50","text-violet-600 border-violet-200 bg-violet-50","text-purple-600 border-purple-200 bg-purple-50","text-fuchsia-600 border-fuchsia-200 bg-fuchsia-50","text-pink-600 border-pink-200 bg-pink-50","text-rose-600 border-rose-200 bg-rose-50"],E=function(e){var t=e.id,r=e.title,n=h.ZP.useMessage(),s=i()(n,1)[0],d=(0,l.Z)(!1),p=i()(d,2),x=p[0],m=p[1].set,b=(0,a.yR)(y()(g()().mark((function e(){var r;return g()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return m(!0),e.next=3,o.f.tag.where({type:t}).sortBy("sort");case 3:return r=e.sent,m(!1),e.abrupt("return",r);case 6:case"end":return e.stop()}}),e)})))),v=(0,l.Z)(!1),Z=i()(v,2),C=Z[0],V=Z[1],N=V.setTrue,E=V.setFalse,q=(0,F.useState)(),M=i()(q,2),S=M[0],K=M[1],L=(0,l.Z)(!1),O=i()(L,2),z=O[0],G=O[1],U=G.setTrue,_=G.setFalse,H=function(){var e=y()(g()().mark((function e(){return g()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(console.log("onDelTagType"),!x){e.next=3;break}return e.abrupt("return");case 3:return e.next=5,B.Z.confirm({title:"确认删除 ".concat(r," 吗？"),onOk:function(){var e=y()(g()().mark((function e(){return g()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return m(!0),e.next=3,o.f.tagType.delete(t);case 3:m(!1);case 4:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}()});case 5:e.sent&&s.success("删除成功"),m(!1);case 8:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),J=(0,I.Dy)((0,I.VT)(I.MA,{activationConstraint:{distance:5}}),(0,I.VT)(I.we,{activationConstraint:{distance:5}}));return(0,w.jsxs)(u.Z,{title:r,headerBordered:!0,collapsible:!0,defaultCollapsed:!0,actions:(0,w.jsxs)(w.Fragment,{children:[(0,w.jsxs)("div",{className:"flex items-center justify-center flex-1 gap-2",onClick:N,children:[(0,w.jsx)(T.Z,{},"edit"),"编辑"]}),!x&&!(null!=b&&b.length)&&(0,w.jsxs)("div",{className:"flex items-center justify-center flex-1 gap-2",onClick:H,children:[(0,w.jsx)(P.Z,{},"del"),"删除"]})]}),children:[!(null==b||!b.length)&&(0,w.jsx)(I.LB,{sensors:J,onDragEnd:function(e){var t=e.active,r=e.over;if(r&&b&&t.id!==r.id){var n=b.findIndex((function(e){return e.id===t.id})),i=b.findIndex((function(e){return e.id===r.id})),a=(0,R.Rp)(b,n,i).map((function(e,t){return f()(f()({},e),{},{sort:t+1})}));o.f.tag.bulkUpdate(a.map((function(e){return{key:e.id,changes:{sort:e.sort}}}))),console.log("newTagList",a)}},collisionDetection:I.pE,children:(0,w.jsx)(R.Fo,{items:b,strategy:R.PG,children:(0,w.jsx)(c.Z,{wrap:"wrap",gap:8,children:null==b?void 0:b.map((function(e,t){return(0,w.jsx)(A,{tag:e,className:D[t%D.length],onClick:function(){return function(e){K(e),U()}(e.id)}},e.id)}))})})}),(0,w.jsx)(j,{id:S,type:"update",visible:z,onCancel:_}),(0,w.jsx)(k,{id:t,type:"update",visible:C,onCancel:E})]})},q=function(){var e=(0,a.yR)((function(){return o.f.tagType.orderBy("sort").toArray()}),[],[]),t=(0,l.Z)(!1),r=i()(t,2),n=r[0],p=r[1],f=p.setTrue,x=p.setFalse,g=(0,l.Z)(!1),m=i()(g,2),y=m[0],b=m[1],v=b.setTrue,h=b.setFalse;return(0,w.jsx)(s._z,{children:(0,w.jsxs)(u.Z,{extra:(0,w.jsxs)(c.Z,{gap:"small",align:"center",children:[(0,w.jsx)(d.ZP,{type:"primary",onClick:f,children:"新建标签类型"}),(0,w.jsx)(d.ZP,{type:"primary",onClick:v,children:"新建标签"})]}),children:[null==e?void 0:e.map((function(e){return(0,w.jsx)(E,{id:e.id,title:e.name},e.id)})),(0,w.jsx)(k,{visible:n,onCancel:x}),(0,w.jsx)(j,{visible:y,onCancel:h})]})})}}}]);