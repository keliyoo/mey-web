import{b as G,n as V,m as C,d as I,t as j,e as W,f as F,g as b,h as $,i as z,j as M,a as o,k as B,l as A,p as O,s as D,u as q,q as T,r as E,o as H,v as U,w,x as J,y as L,F as K,z as Q,A as X,B as Y,_ as Z}from"./index-765ffbb1.js";import{u as ee}from"./time-636e1097.js";const[te,x]=G("circle");let ae=0;const N=e=>Math.min(Math.max(+e,0),100);function oe(e,f){const m=e?1:0;return`M ${f/2} ${f/2} m 0, -500 a 500, 500 0 1, ${m} 0, 1000 a 500, 500 0 1, ${m} 0, -1000`}const se={text:String,size:V,fill:C("none"),rate:I(100),speed:I(0),color:[String,Object],clockwise:j,layerColor:String,currentRate:W(0),strokeWidth:I(40),strokeLinecap:String,startPosition:C("top")};var ne=F({name:te,props:se,emits:["update:currentRate"],setup(e,{emit:f,slots:m}){const r=`van-circle-${ae++}`,p=b(()=>+e.strokeWidth+1e3),h=b(()=>oe(e.clockwise,p.value)),R=b(()=>{const t={top:0,right:90,bottom:180,left:270}[e.startPosition];if(t)return{transform:`rotate(${t}deg)`}});$(()=>e.rate,a=>{let t;const l=Date.now(),s=e.currentRate,n=N(a),d=Math.abs((s-n)*1e3/+e.speed),i=()=>{const u=Date.now(),v=Math.min((u-l)/d,1)*(n-s)+s;f("update:currentRate",N(parseFloat(v.toFixed(1)))),(n>s?v<n:v>n)&&(t=M(i))};e.speed?(t&&z(t),t=M(i)):f("update:currentRate",n)},{immediate:!0});const c=()=>{const{strokeWidth:t,currentRate:l,strokeLinecap:s}=e,n=3140*l/100,d=A(e.color)?`url(#${r})`:e.color,i={stroke:d,strokeWidth:`${+t+1}px`,strokeLinecap:s,strokeDasharray:`${n}px 3140px`};return o("path",{d:h.value,style:i,class:x("hover"),stroke:d},null)},S=()=>{const a={fill:e.fill,stroke:e.layerColor,strokeWidth:`${e.strokeWidth}px`};return o("path",{class:x("layer"),style:a,d:h.value},null)},k=()=>{const{color:a}=e;if(!A(a))return;const t=Object.keys(a).sort((l,s)=>parseFloat(l)-parseFloat(s)).map((l,s)=>o("stop",{key:s,offset:l,"stop-color":a[l]},null));return o("defs",null,[o("linearGradient",{id:r,x1:"100%",y1:"0%",x2:"0%",y2:"0%"},[t])])},_=()=>{if(m.default)return m.default();if(e.text)return o("div",{class:x("text")},[e.text])};return()=>o("div",{class:x(),style:B(e.size)},[o("svg",{viewBox:`0 0 ${p.value} ${p.value}`,style:R.value},[k(),S(),c()]),_()])}});const re=O(ne),le=e=>(Q("data-v-228ac4bd"),e=e(),X(),e),ce=le(()=>Y("div",{class:"title"},null,-1)),ie=F({__name:"TimeLoopView",setup(e){const f=ee(),{src:m,controls:r}=D(q()),p=b(()=>f.loopSets.find(i=>i.selected)),h={"0%":"#3fecff","100%":"#6149f6"},R=T(1),c=T(0),S=()=>{switch(console.log("onCircleClick"),c.value){case 0:c.value=1;break;case 1:c.value=2;break;case 2:c.value=1;break}};let k=0,_=T(1);const a=T(0),t=T(!1),l=()=>{clearInterval(k),_.value=0,a.value=0,t.value=!1},s=()=>{clearInterval(k);const i=p.value[t.value?"loopGapTime":"loopTime"],u=100,y=100/(i*1e3/u);console.log("intervalRate",y),k=window.setInterval(()=>{const v=a.value+y;if(v>=100){const g=!t.value;if(_.value+1>p.value.loopTimes){n();return}t.value=g,_.value=g?_.value:_.value+1,a.value=0,s();return}a.value=v},u)},n=()=>{clearInterval(k)};let d=0;return $([c],()=>{switch(c.value){case 0:l(),d=0,r.value.playing=!1,r.value.currentTime=0;break;case 1:m.value=p.value.src||"",t.value||(r.value.currentTime=d,r.value.playing=!0),s();break;case 2:d=r.value.currentTime||0,r.value.playing=!1,n();break}}),$([t],()=>{r.value.playing=!t.value}),(i,u)=>{const y=E("van-row"),v=E("van-button"),g=E("van-col");return H(),U(K,null,[ce,o(y,{justify:"center"},{default:w(()=>[o(J(re),{class:"cursor-pointer",onClick:S,"current-rate":R.value,"onUpdate:currentRate":u[0]||(u[0]=P=>R.value=P),rate:a.value,color:t.value?"#07c160":h,"layer-color":"#ebedf0","stroke-width":60,size:"200",text:t.value?"间隙":"运行"},null,8,["current-rate","rate","color","text"])]),_:1}),o(y,{justify:"space-around",class:"box-warp"},{default:w(()=>[o(g,{span:"8"},{default:w(()=>[o(v,{block:"",type:"warning",onClick:u[1]||(u[1]=P=>c.value=0)},{default:w(()=>[L("重置")]),_:1})]),_:1}),o(g,{span:"8"},{default:w(()=>[o(v,{block:"",type:"primary",to:"/time/loop/set"},{default:w(()=>[L("修改设置")]),_:1})]),_:1})]),_:1})],64)}}});const de=Z(ie,[["__scopeId","data-v-228ac4bd"]]);export{de as default};
