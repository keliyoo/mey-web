import{u as F}from"./time-a6fbff04.js";import{b as G,n as V,m as I,d as S,t as j,e as A,f as L,g as R,h as N,i as W,j as E,a,k as z,l as $,p as O,q as h,r as P,o as B,s as D,w,u as q,v as C,F as H,x as U,y as J,z as K,_ as Q}from"./index-04bf26dd.js";const[X,x]=G("circle");let Y=0;const M=e=>Math.min(Math.max(+e,0),100);function Z(e,v){const u=e?1:0;return`M ${v/2} ${v/2} m 0, -500 a 500, 500 0 1, ${u} 0, 1000 a 500, 500 0 1, ${u} 0, -1000`}const ee={text:String,size:V,fill:I("none"),rate:S(100),speed:S(0),color:[String,Object],clockwise:j,layerColor:String,currentRate:A(0),strokeWidth:S(40),strokeLinecap:String,startPosition:I("top")};var te=L({name:X,props:ee,emits:["update:currentRate"],setup(e,{emit:v,slots:u}){const y=`van-circle-${Y++}`,_=R(()=>+e.strokeWidth+1e3),i=R(()=>Z(e.clockwise,_.value)),g=R(()=>{const o={top:0,right:90,bottom:180,left:270}[e.startPosition];if(o)return{transform:`rotate(${o}deg)`}});N(()=>e.rate,n=>{let o;const r=Date.now(),t=e.currentRate,s=M(n),l=Math.abs((t-s)*1e3/+e.speed),c=()=>{const p=Date.now(),b=Math.min((p-r)/l,1)*(s-t)+t;v("update:currentRate",M(parseFloat(b.toFixed(1)))),(s>t?b<s:b>s)&&(o=E(c))};e.speed?(o&&W(o),o=E(c)):v("update:currentRate",s)},{immediate:!0});const k=()=>{const{strokeWidth:o,currentRate:r,strokeLinecap:t}=e,s=3140*r/100,l=$(e.color)?`url(#${y})`:e.color,c={stroke:l,strokeWidth:`${+o+1}px`,strokeLinecap:t,strokeDasharray:`${s}px 3140px`};return a("path",{d:i.value,style:c,class:x("hover"),stroke:l},null)},f=()=>{const n={fill:e.fill,stroke:e.layerColor,strokeWidth:`${e.strokeWidth}px`};return a("path",{class:x("layer"),style:n,d:i.value},null)},m=()=>{const{color:n}=e;if(!$(n))return;const o=Object.keys(n).sort((r,t)=>parseFloat(r)-parseFloat(t)).map((r,t)=>a("stop",{key:t,offset:r,"stop-color":n[r]},null));return a("defs",null,[a("linearGradient",{id:y,x1:"100%",y1:"0%",x2:"0%",y2:"0%"},[o])])},d=()=>{if(u.default)return u.default();if(e.text)return a("div",{class:x("text")},[e.text])};return()=>a("div",{class:x(),style:z(e.size)},[a("svg",{viewBox:`0 0 ${_.value} ${_.value}`,style:g.value},[m(),f(),k()]),d()])}});const ae=O(te),oe=e=>(U("data-v-cf5e958d"),e=e(),J(),e),se=oe(()=>K("div",{class:"title"},null,-1)),ne=L({__name:"TimeLoopView",setup(e){const v=F(),u=R(()=>v.loopSets.find(t=>t.selected)),y={"0%":"#3fecff","100%":"#6149f6"},_=h(1),i=h(0),g=()=>{switch(console.log("onCircleClick"),i.value){case 0:i.value=1;break;case 1:i.value=2;break;case 2:i.value=1;break}};let k=0,f=h(1);const m=h(0),d=h(!1),n=()=>{clearInterval(k),f.value=0,m.value=0,d.value=!1},o=()=>{clearInterval(k);const t=u.value[d.value?"loopGapTime":"loopTime"],s=100,l=100/(t*1e3/s);console.log("intervalRate",l),k=window.setInterval(()=>{const c=m.value+l;if(c>=100){const p=!d.value;if(f.value+1>u.value.loopTimes){r();return}d.value=p,f.value=p?f.value:f.value+1,m.value=0,o();return}m.value=c},s)},r=()=>{clearInterval(k)};return N([i],()=>{switch(i.value){case 0:n();break;case 1:o();break;case 2:r();break}}),(t,s)=>{const l=P("van-row"),c=P("van-button"),p=P("van-col");return B(),D(H,null,[se,a(l,{justify:"center"},{default:w(()=>[a(q(ae),{class:"cursor-pointer",onClick:g,"current-rate":_.value,"onUpdate:currentRate":s[0]||(s[0]=T=>_.value=T),rate:m.value,color:d.value?"#07c160":y,"layer-color":"#ebedf0","stroke-width":60,size:"200",text:d.value?"间隙":"运行"},null,8,["current-rate","rate","color","text"])]),_:1}),a(l,{justify:"space-around",class:"box-warp"},{default:w(()=>[a(p,{span:"8"},{default:w(()=>[a(c,{block:"",type:"warning"},{default:w(()=>[C("重置")]),_:1})]),_:1}),a(p,{span:"8"},{default:w(()=>[a(c,{block:"",type:"primary"},{default:w(()=>[C("修改设置")]),_:1})]),_:1})]),_:1})],64)}}});const ce=Q(ne,[["__scopeId","data-v-cf5e958d"]]);export{ce as default};
